<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Shunter Move Tracker</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      background: #f4f4f4;
      color: #333;
    }

    h2 {
      text-align: center;
      margin-top: 10px;
    }

    .section {
      padding: 15px;
    }

    .drivers {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      justify-content: center;
    }

    .driver-btn {
      padding: 8px 12px;
      background-color: #00bfa6;
      border: none;
      border-radius: 6px;
      color: white;
      cursor: grab;
      font-weight: bold;
      transition: background-color 0.3s, transform 0.2s;
      user-select: none;
    }

    .driver-btn:hover {
      background-color: #009e8c;
    }

    .driver-btn.dragging {
      opacity: 0.5;
      transform: scale(0.9);
    }

    .driver-btn.over {
      border: 2px dashed #007f6e;
      background-color: #c2fff5;
    }

    /* Pink active state */
    .driver-btn.active {
      background-color: pink !important;
      color: #333;
    }

    #historyContainer {
      background: white;
      padding: 10px;
      border-radius: 10px;
      margin: 20px;
      max-width: 600px;
      margin-left: auto;
      margin-right: auto;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    #historyContainer h3 {
      margin-top: 0;
      text-align: center;
    }

    #historyList {
      list-style: none;
      padding: 0;
      margin: 0;
      max-height: 250px;
      overflow-y: auto;
    }

    #historyList li {
      padding: 6px 8px;
      border-bottom: 1px solid #ddd;
      font-size: 15px;
    }

    #clearMsg {
      text-align: center;
      color: #888;
      font-size: 14px;
      margin-top: 10px;
    }

    /* input box section */
    .add-section {
      text-align: center;
      margin-bottom: 15px;
    }

    .add-section input {
      padding: 6px 10px;
      border: 1px solid #ccc;
      border-radius: 6px;
      width: 160px;
      font-size: 14px;
    }

    .add-section button {
      padding: 6px 12px;
      background-color: #0078d7;
      border: none;
      color: white;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
      margin-left: 5px;
    }

    .add-section button:hover {
      background-color: #005fa3;
    }
  </style>
</head>
<body>

  <div class="section">
    <h2>üè¢ SHUNTER APP</h2>

    <!-- new input area -->
    <div class="add-section">
      <input type="text" id="newNameInput" placeholder="Enter name..." />
      <button id="addBtn">OK</button>
    </div>

    <div class="drivers" id="driversContainer"></div>
  </div>

  <div id="historyContainer">
    <h3>üìú Move History (Today)</h3>
    <ul id="historyList"></ul>
    <p id="clearMsg"></p>
  </div>

  <script>
    let draggedItem = null;

    function createButton(name) {
      const btn = document.createElement('button');
      btn.textContent = name;
      btn.className = 'driver-btn';
      btn.draggable = true;

      // --- long press detection ---
      let pressTimer = null;
      let isActive = false;

      btn.addEventListener('mousedown', () => {
        pressTimer = setTimeout(() => {
          if (!isActive) {
            isActive = true;
            btn.classList.add('active');
            btn.textContent = '‚ö° ' + name;
            setTimeout(() => {
              btn.classList.remove('active');
              btn.textContent = name;
              isActive = false;
            }, 5000);
          }
        }, 5000);
      });

      ['mouseup', 'mouseleave'].forEach(event =>
        btn.addEventListener(event, () => clearTimeout(pressTimer))
      );
      // --- end long press ---

      // Drag start
      btn.addEventListener('dragstart', (e) => {
        draggedItem = e.target;
        e.target.classList.add('dragging');
      });

      // Drag end
      btn.addEventListener('dragend', (e) => {
        e.target.classList.remove('dragging');
        draggedItem = null;
      });

      // Drag over another button
      btn.addEventListener('dragover', (e) => {
        e.preventDefault();
        btn.classList.add('over');
      });

      // Leave button
      btn.addEventListener('dragleave', () => {
        btn.classList.remove('over');
      });

      // Drop on another button (records the action)
      btn.addEventListener('drop', (e) => {
        e.preventDefault();
        btn.classList.remove('over');
        if (draggedItem && draggedItem !== btn) {
          const from = draggedItem.textContent;
          const to = btn.textContent;
          const action = `${new Date().toLocaleTimeString()} ‚ûú ${from} moved over ${to}`;
          addHistory(action);
        }
      });

      return btn;
    }

    function createBuildingButtons() {
      const container = document.getElementById('driversContainer');

      const headingB = document.createElement('h3');
      headingB.textContent = 'üèóÔ∏è Building B';
      headingB.style.width = '100%';
      headingB.style.textAlign = 'center';
      container.appendChild(headingB);

      for (let i = 1; i <= 25; i++) container.appendChild(createButton(`B${i}`));

      const headingMiddle = document.createElement('h3');
      headingMiddle.textContent = 'üöõ Middle Area';
      headingMiddle.style.width = '100%';
      headingMiddle.style.textAlign = 'center';
      container.appendChild(headingMiddle);

      const middleButtons = ['Yard', 'Mire', 'Mark', 'Andre', 'Zak', 'Adorjan','POWER'];
      middleButtons.forEach(name => container.appendChild(createButton(name)));

      const headingC = document.createElement('h3');
      headingC.textContent = 'üèóÔ∏è Building C';
      headingC.style.width = '100%';
      headingC.style.textAlign = 'center';
      container.appendChild(headingC);

      for (let i = 1; i <= 26; i++) container.appendChild(createButton(`C${i}`));
    }

    function addHistory(action) {
      const historyList = document.getElementById('historyList');
      const li = document.createElement('li');
      li.textContent = action;
      historyList.prepend(li);

      const today = new Date().toISOString().split('T')[0];
      let historyData = JSON.parse(localStorage.getItem('dailyHistory')) || {};
      if (!historyData.date || historyData.date !== today) {
        historyData = { date: today, actions: [] };
      }
      historyData.actions.unshift(action);
      localStorage.setItem('dailyHistory', JSON.stringify(historyData));
    }

    function loadHistory() {
      const historyList = document.getElementById('historyList');
      const data = JSON.parse(localStorage.getItem('dailyHistory'));
      const today = new Date().toISOString().split('T')[0];

      if (data && data.date === today) {
        data.actions.forEach((act) => {
          const li = document.createElement('li');
          li.textContent = act;
          historyList.appendChild(li);
        });
      } else {
        localStorage.removeItem('dailyHistory');
      }
    }

    function checkMidnightReset() {
      const now = new Date();
      const nextMidnight = new Date();
      nextMidnight.setHours(24, 0, 0, 0);
      const msUntilMidnight = nextMidnight - now;

      setTimeout(() => {
        localStorage.removeItem('dailyHistory');
        document.getElementById('historyList').innerHTML = '';
        document.getElementById('clearMsg').textContent = "‚úÖ History cleared for the new day!";
        checkMidnightReset();
      }, msUntilMidnight);
    }

    // Add new button by input
    document.getElementById('addBtn').addEventListener('click', () => {
      const input = document.getElementById('newNameInput');
      const name = input.value.trim();
      if (name) {
        const container = document.getElementById('driversContainer');
        const newBtn = createButton(name);
        container.appendChild(newBtn);
        addHistory(`${new Date().toLocaleTimeString()} ‚ûú Created new button "${name}"`);
        input.value = '';
      }
    });

    createBuildingButtons();
    loadHistory();
    checkMidnightReset();
  </script>
</body>
</html>
